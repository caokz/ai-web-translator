# 翻译功能第二次优化 - 快速测试清单

## 🚀 开始测试前的准备

- [ ] 确保运行了 `npm run build`
- [ ] 在 Chrome 中重新加载扩展（chrome://extensions/ → 刷新按钮）
- [ ] 打开新标签页，访问测试URL：
  https://nightlies.apache.org/flink/flink-docs-release-2.2/docs/deployment/config/
- [ ] 打开 F12 开发者工具 → Console 标签
- [ ] 配置了有效的 API Key（DeepSeek/Kimi/等）

---

## ✅ 功能测试

### 测试1：翻译流畅性和顺序（最重要）

**步骤**：
1. 点击扩展图标 → 启用"翻译当前页面"
2. 在 Console 中观察日志
3. **观察翻译过程**，不要离开当前视口

**预期结果** ✅：
- [ ] Console 显示 "🔄 Initializing translation..."
- [ ] Console 显示 "📋 Collected XXX elements for translation"
- [ ] 翻译从顶部开始逐步显示（**而不是随机跳跃**）
- [ ] 页面上半部分的翻译先完成，下半部分后完成
- [ ] Console 最终显示 "✅ All translations completed"

**失败迹象** ❌：
- ❌ 翻译乱跳（中间先翻译，顶部后翻译）
- ❌ 出现大量并发翻译错误
- ❌ 页面卡顿无反应

**评估**：
- 预期耗时：15-30秒（取决于网络和 API 速度）
- 成功：流畅的从上往下显示翻译

---

### 测试2：表格格式保留（格式问题修复）

**步骤**：
1. 等待翻译完成（Test1）
2. 向下滚动找到配置参数表格
3. 在表格中找 "Configuration Parameters" 或类似的表格
4. **仔细观察表格的 "Description" 列**

**预期结果** ✅：
- [ ] Description 列的翻译是**横排显示**，正常可读
- [ ] 单词不是竖排（每个汉字单独一行）
- [ ] 表格宽度没有被破坏
- [ ] 表格对齐正确（不歪斜）
- [ ] 翻译的中文正常换行

**失败迹象** ❌：
- ❌ 看到竖排的中文（每个汉字一行）
- ❌ 翻译内容超出表格边界
- ❌ 表格列错位或压缩

**参考图片**：
查看你发来的 2.png 中，看看是否还有竖排现象。如果不再有，则表示修复成功。

---

### 测试3：虚拟滚动和懒加载翻译

**步骤**：
1. 刷新页面
2. 点击扩展图标 → 启用翻译
3. **立即向下滚动**（不要等翻译完成）
4. 向下滚动到页面的中间或底部
5. 观察翻译的进度

**预期结果** ✅：
- [ ] 顶部的翻译已经完成（你一开始看到的）
- [ ] 中间部分的翻译正在进行（或等待）
- [ ] 底部的内容还没有翻译
- [ ] 继续滚动时，新进入视口的内容开始翻译
- [ ] **不会等待整个页面翻译完才能看到翻译**

**失败迹象** ❌：
- ❌ 必须等到整个页面翻译完才能看到翻译
- ❌ 滚动时出现卡顿
- ❌ 翻译任务没有响应滚动

**评估**：
- 成功指标：可以在翻译进行中舒适地滚动阅读

---

### 测试4：代码块保护（不翻译代码）

**步骤**：
1. 等待翻译完成
2. 向下滚动找到 Maven 代码块（`<dependency>` 等）
3. 查找页面中的 `<pom.xml>` 代码示例

**预期结果** ✅：
- [ ] 代码块中的内容**完全保持原样，不被翻译**
- [ ] `<dependency>` 、 `<groupId>` 等 XML 标签未被翻译
- [ ] 但代码块**外**的说明文字被翻译了

**失败迹象** ❌：
- ❌ 代码内容被翻译了
- ❌ Maven 配置中出现中文

---

### 测试5：关闭和重新启用翻译

**步骤**：
1. 翻译已启用，页面显示翻译后的内容
2. 点击扩展图标 → 禁用"翻译当前页面"
3. 观察页面变化
4. 再次点击扩展图标 → 启用"翻译当前页面"
5. 观察翻译是否重新开始

**预期结果** ✅：
- [ ] 禁用后，所有翻译消失，页面恢复全英文
- [ ] Console 显示 "🔄 Removing all translations..." 和 "✅ All translations removed"
- [ ] 没有残留的翻译 div 或样式问题
- [ ] 重新启用后，翻译正常进行
- [ ] **不会出现无限嵌套翻译的问题**（之前的 Bug）

**失败迹象** ❌：
- ❌ 禁用后还能看到翻译
- ❌ 重新启用时出现无限嵌套翻译
- ❌ Console 中有错误信息
- ❌ 页面混乱

---

### 测试6：并发控制验证

**步骤**：
1. 打开 F12 → Network 标签
2. 启用翻译
3. 观察 API 请求

**预期结果** ✅：
- [ ] 同时进行的翻译请求**不超过2个**
- [ ] 请求完成后，下一个请求才开始
- [ ] 请求顺序与 DOM 顺序大致相同
- [ ] 不会有 3-4 个并发请求一起发送

**失败迹象** ❌：
- ❌ 看到 3 个或以上的并发请求
- ❌ 请求乱序

**验证方法**：
在 Network 标签中看到的翻译请求，应该大部分是串行的（一个接一个），偶尔有2个并发。

---

## 🔍 Console 日志检查

### 正常日志应该是这样的：

```
🚀 Content Script initializing...
✅ Content Script initialized
🔄 Initializing translation...
📋 Collected 342 elements for translation
(翻译进行中，可能需要几秒到十几秒...)
✅ All translations completed
```

### 异常日志示例（出现以下说明有问题）：

```
❌ Uncaught TypeError: Cannot read property...
❌ Translation error: ...
⚠️  No translatable elements found
```

---

## 📊 性能对比（自我评估）

完成上述测试后，自己评估一下改进效果：

| 指标 | 修改前 | 修改后 |
|------|--------|--------|
| **翻译顺序** | 随意跳跃 | 从上到下 | ✅ / ❌ |
| **首屏加载** | 等全部翻译 | 可以边看边翻 | ✅ / ❌ |
| **表格格式** | 竖排乱码 | 正常显示 | ✅ / ❌ |
| **代码块** | 被翻译 | 保持原样 | ✅ / ❌ |
| **流畅性** | 卡顿 | 流畅 | ✅ / ❌ |

---

## 🐛 如果测试失败

### 如果翻译显示还是乱跳：
- [ ] 检查 Console 中是否有错误信息
- [ ] 确保 MAX_CONCURRENT_TRANSLATIONS = 2
- [ ] 尝试刷新页面重新加载扩展

### 如果表格还是竖排显示：
- [ ] 打开 DevTools → Elements
- [ ] 找到翻译的 div 元素
- [ ] 右键 → Inspect，查看 CSS 属性
- [ ] 确认是否包含 `white-space: normal` 等属性

### 如果代码块被翻译：
- [ ] 检查代码块的 HTML 结构
- [ ] 查看是否使用了 `<code>` 或 `<pre>` 标签
- [ ] 查看是否有 `hljs` 或 `language-` 的 class

---

## ✨ 完成检查

如果所有测试都通过 ✅，则说明优化成功：

- ✅ 翻译从上到下流畅显示
- ✅ 大页面支持虚拟滚动懒加载
- ✅ 表格和特殊容器格式正常
- ✅ 代码块保持原样不翻译
- ✅ 并发控制有效（最多2个）
- ✅ 开启/关闭翻译工作正常

---

## 📝 问题反馈模板

如果出现问题，请提供以下信息：

```
【问题描述】
- 具体问题是什么？
- 在哪个网页上遇到的？

【复现步骤】
1. ...
2. ...
3. ...

【预期结果】
- 应该...

【实际结果】
- 实际上...

【Console日志】
（复制 F12 Console 中的所有日志）

【Network请求】
（如果涉及API，说明有几个并发请求）

【浏览器】
- Chrome 版本：...
- 扩展版本：...
```

---

**现在开始测试吧！** 🎉
